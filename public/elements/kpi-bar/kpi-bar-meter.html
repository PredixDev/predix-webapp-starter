<!-- import polymer -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<!-- import page level css -->
<link rel="import" href="kpi-bar-styles.html">

<dom-module id="kpi-bar-meter">
  <template>
    <style include="kpi-bar-styles"></style>

        <div class="kpi-bar-meter-wrapper">
          <template id="kpiBarMeterBarWrappers" is="dom-repeat" items="[[bars]]">
            <div class="kpi-bar-meter-bar-wrapper">
              <div class="kpi-bar-meter-bar-content" style="width: [[item.width]]%">
              </div>
            </div>
          </template>
        </div>
  </template>
  <script>
  Polymer({
    is: 'kpi-bar-meter',
    properties: {
      bars: [],
      percentage: {
        type: Number,
        observer: 'percentChanged'
      }
    },

    listeners: {
      'iron-resize': '_onResize'
    },

    _onResize: function() {
      // console.log('resized. width: ', this.parentElement.clientWidth);
      if (this.parentElement.clientWidth < 200) {
        this.style.display = 'none';
      } else {
        this.style.display = '';
      }
    },

    percentChanged: function(){
      var barsExact = (this.percentage / 100) * 20;
      var barsComplete = Math.floor(barsExact);
      var partialBar = (barsExact % 5) / 5;
      var barsOff = 20 - barsComplete - Math.ceil(partialBar);
      var barsToDraw = [];
      for (var i=0; i < barsComplete; i++) {
        barsToDraw.push({ width: '100'});
      };
      if (partialBar > 0) {
        barsToDraw.push({ width: partialBar * 100 + ''});
      };
      for (var j=0; j < barsOff; j++) {
        barsToDraw.push({ width: '0'});
      }
      this.bars = barsToDraw;
    },

    behaviors: [
      Polymer.IronResizableBehavior
    ]
  });
  </script>
</dom-module>
